pragma solidity 0.8.19;

import "forge-std/Test.sol";
import "src/Dex.sol";
import "src/Exploit.sol";

contract TestExploit is Test {
    function test_exploit() public {
        Dex d = new Dex();
        SwappableToken token1 = new SwappableToken(address(d), "token1", "T1", 110);
        SwappableToken token2 = new SwappableToken(address(d), "token2", "T2", 110);

        d.setTokens(address(token1), address(token2));
        token1.approve(address(d), 100);
        token2.approve(address(d), 100);
        d.addLiquidity(address(token1), 100);
        d.addLiquidity(address(token2), 100);

        Exploit e = new Exploit();
        token1.approve(address(e), 10);
        token2.approve(address(e), 10);

        e.exploit(address(d));

        uint256 dexToken1Balance = token1.balanceOf(address(d));
        uint256 dexToken2Balance = token2.balanceOf(address(d));
        assert(dexToken1Balance == 0 || dexToken2Balance == 0);
   }
}
